# Topic 38. 우연에 맡기는 프로그래

## 우연에 맡기는 프로그래밍하기
키보드를 두들겨 코드를 약간 작성한다. 잘 돌아가는 것 같다.  
코드를 조금 더 덧붙이고, 또 돌려본다. 여전히 잘 돌아가는 듯 하다.  
이런식으로 몇 주 동안 코딩을 하는데 갑자기 프로그램이 돌아가지 않는다. 고치려 노력했지만 원인을 못찾겠다.  
어떤 시도를 해 봐도 코드는 돌아갈 낌새도 보이지 않는다.  
  

왜 코드가 망가졌는지 모르는 까닭은 애초에 코드가 왜 잘 돌아가는지도 몰랐기 때문이다.  
근거가 없느 확신을 갖고 계속 앞으로 나아갔고, 그 결과 대실패를 맛보았다. 

## 구현에서 생기는 우연
단순히 코드가 지금 작성된 방식이 그렇기 떄문에 생기는 우연한 일들이 있다. 이런 우연에 기대다 보면 결국 문서화되지 않은 에러나 예외적인 경우의 동작에 의존하게 되고 만다.  
예를들면.. 어떤 루틴을 잘못된 데이터를 가지고 호출했다. 루틴은 예상하지 못한 데이터에 특정한 방식으로 반응을 하고, 우리는 그 반응을 기반으로 코드를 작성한다.  
하지만 루틴을 만든 사람의 의도는 그 루틴이 그런 식으로 작동하는 것이 아니었다. 이 루틴을 '고치면' 우리가 작성한 코드는 작동을 멈출 수도 있다.  
잘 작동하는 데 괜히 걸드려서 일을 만들필요는 없다???? 당연히 아님;;    
 - 정말로 제대로 돌아가는 게 아닐지도 모른다. 그저 돌아가는 듯이 보이는 것일 수도 있다.
 - 의존하는 조건이 단지 우연인 경우도 있다. 화면 해상도가 다른 경우나 CPU 코어가 더 많은 경우 등 다른 상황에서는 이상하게 작동할지도 모른다.
 - 문서화되지 않은 동작은 라이브러리의 다음 릴리스에서 변경될 수도 있다.
 - 불필요한 추가 호출은 코드를 더 느리게 만든다.
 - 추가로 호출한 루틴에서 새로운 버그가 생길 수도 있다. 
  
다른 사람이 호출할 코드를 작성하고 있다면 모듈화를 잘하는 것, 그리고 잘 문서화한 적은 수의 인터페이스 아래에 구현을 숨기는 것 같은 기본 원칙들을 잘 지키자.  

## 비슷하다고 괜찮을 리는 없다
어떤 프로젝트를 하고 있는데, 프로젝트의 기능 결과가 다 똑같은데 시간만 딱 한 시간만 달랐음..  
'딱' 한 시간만 틀린거니까 괜찮다며 그냥 1시간을 더하거나 뺴서 답을 계산해버림..  
근데 사실 '딱' 한시간만 틀린건 우연이었다. 사실은 더 깊고 근본적인 원인이 있었다.  
시간을 다루는 적절한 모델이 없기 떄문에 말도 안되는 양의 +1, -1 명령들이 코드 전체에 퍼져 나갔다. 결국 제대로 맞는 값이 없었고, 프로젝트는 폐기되었다.  

## 유령패턴
인간은 언제나 패턴과 인과 관계를 찾으려고 한다. 그저 우연에 불과한 것들 속에서도 그렇다.  
도박꾼은 복권 번호, 주사위 숫자, 룰렛 번호의 패턴을 상상한다. 사실을 모두 독립적인 것임에도 불구하고..  
로그 파일 요청 1,000개당 한 번꼴로 간헐적으로 발생하는 오류가 남아있다면 분석하기 어려운 경합조건이 있을 수도 있지만 그래 오래된 버그일 수도 있다.  
테스트가 내 장비에선 통과했는데, 서버에서는 통과를 못하는 이유는 두 환경의 차이 때문일 수도 있지만 어쩌면 우연일수도 있다.  
가정하지 말라. 증명하라.

## 상황에서 생기는 우연
모듈을 만드려고 한다. GUI앱에서 쓰려고 작성하는 모듈이라고 해도, GUI가 있는 환경에서만 돌아가도록 해야 할 필요가 있을까?  
사용자의 언어가 한국어일꺼라고 가정하고 있지 않은가?  
사용자가 글을 읽을 수 있다고 생각하는가? 확실한 것이 아닌데도 의존하고 있는 것은 또 무엇이 있을까?  
인터넷 검색으로 찾은 첫 번째 답에서 코드를 복붙하려 할 때 나와 동일한 상황이라고 확신하는가? 아니면 그냥 무지성 복붙인가?  
잘 되는 듯한 답을 찾는 것과 올바른 답을 찾는 것은 다르다. 

## 암묵적인 가정
가정하지 말라. 증명하라.  
사람들은 마음속에 많은 가정을 품고 작업한다. 하지만 이 가정을 문서화하는 경우는 드물며, 개발자마다의 가정은 다르다.  
확고한 사실에 근거하지 않은 가정은 어떤 프로젝트에서든 재앙의 근원이 된다.  

## 의도적으로 프로그래밍하기
우리는 애초에 오류를 더 적게 만들고 싶어한다. 그러면 의도적으로 프로그래밍 해야한다. 
 - 언제나 내가 지금 무엇을 하고 있는지 알아야 한다.
 - 더 경험이 적은 프로그래머에게 코드를 상세히 설명할 수 있는가? 그렇지 않다면 아마 우연에 기대고 있는 것일것이다.
 - 자신도 잘 모르는 코드를 만들지 말라. 완전히 파악하지 못한 앱을 빌드하거나, 이해하지 못한 기술을 사용하면 우연의 함정에 빠질 가능성이 높다. 왜 작동하는지 모르면, 왜 실패하는지도 모른다.
 - 계확을 세우고 그것을 바탕으로 진행하라.
 - 신뢰할 수 있는것에만 기대라. 가정에 의존하지 말라. 무엇을 신뢰할지 모르겠으면 최악의 상황을 가정하라.
 - 가정을 기록으로 남겨라
 - 코드뿐 아니라 내가 세운 가정도 테스트 해야한다. 어떤 일이든 추측만 하지 말고 실제로 시험해 보라.
 - 노력을 기울일 대상의 우선순위를 정하라.
 - 과거의 노예가 되지 말아라. 기존 코드가 앞으로 짤 코드를 지배하도록 놓아두지 말라. 더는 적절한 코드가 아니다 싶으면 어떤 코드라도 교체할 수 있다. 한 프로그램 안에서도 예전에 한 일이 앞으로 할 일을 제약하지 못하도록 하라. 언제나 리팩터링할 자세가 되어 있여아 한다.




































